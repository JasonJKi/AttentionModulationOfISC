% Generate figure 4.
clear all
file = [1 2 3];
run ../../Codes/BDFRead/EEGDetail.m
experiment = { 'Freeview'    'Fixation'    'Audio' };
EEGLoadPath = '../../EEG/Processed/';
Version = 'RPCAProcessed_v4/'
EEGLoadPath = [EEGLoadPath Version]
nComp = 10;nGamma = 1;grassman = 0;dim = 64; gamma = .5;
saveMat = 'figure4values_v3'

iAllStim = 1
for iFile = file
    
    stims=Stims{iFile};stimsave=Stimsave{iFile};
    subjname=Subjname{iFile};eogchannel=Eogchannel{iFile};                                                                                                                           % load                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Attend = Disattend{iFile};
    subjrmv = Indsubjrmv{iFile};
        
    nStim = length(stims);
    for iStim = 1:nStim;
        
         stimsave{iStim} 
        load([EEGLoadPath experiment{iFile} '/' stimsave{iStim} '.mat'],'eeg');eval(['x' '=eeg;' ]);
        x(:,:,subjrmv) = [];
        [n n Rxy{iAllStim} Rpool{iAllStim}] = generate_all_cov(x);        
        iAllStim = iAllStim+1;
    end
end

save(saveMat,'Rxy','Rpool')
% nComp = 15;
% % headprojection
% attendGroup = {[1 2], [5 6], [9 10 11]}
% A = zeros(64,nComp);ISC =zeros(nComp);
% for iFile = 1:3
%     RxyGrouped = zeros(64);
%     RpoolGrouped = zeros(64);
%     for iStim = attendGroup{iFile}
%     RxyGrouped = RxyGrouped + Rxy{iStim};
%     RpoolGrouped = RpoolGrouped + Rpool{iStim};
%     end
%     [A(:,:,iFile) ISC(:,iFile)] = correlated_components(RxyGrouped, RpoolGrouped, .5, 0, 64, nComp, 0,0);
% end
% figure(1)
% headprojection(A,ISC,nComp)
% % hline = figurelabels(labels,interval,orientation,figIndx,fontsize);
% 
% A = zeros(64,nComp);ISC =zeros(nComp);
% RxyGrouped = zeros(64,64,2);
% RpoolGrouped = zeros(64,64,2);
% cond = {[1 2 5 6 9] [3 4 7 8 12 13 14]};
% for i = 1:2
%     for iStim =  cond{i};
%         RxyGrouped(:,:,i) = RxyGrouped(:,:,i) + Rxy{iStim};
%         RpoolGrouped(:,:,i) = RpoolGrouped(:,:,i) + Rpool{iStim};
%     end
%     [A(:,:,i) ISC(:,i)] = correlated_components(RxyGrouped(:,:,i), RpoolGrouped(:,:,i), .5, 0, 64, nComp, 0,0);
% end
% figure(2)
% headprojection(A,ISC,nComp)
% % hline = figurelabels(labels,interval,orientation,figIndx,fontsize);
